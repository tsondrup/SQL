/* Create Subscriptions Table */

CREATE TABLE subscriptions (
    subscription_id VARCHAR PRIMARY KEY,
    account_id VARCHAR,
    subscription_start_date DATE,
    subscription_end_date DATE,
    trial_start_date DATE,
    trial_end_date DATE,
    revenue DECIMAL (7,2)
)

/* Create Visits Table */

CREATE TABLE visits (
    visit_id VARCHAR PRIMARY KEY,
    account_id VARCHAR,
    day DATE,
    region VARCHAR,
    language VARCHAR,
    channel VARCHAR,
    landing_page VARCHAR
)

/* 1. How much revenue did each region generate within the time frame covered by
the data sets? */

SELECT visits.region AS 'Region', SUM(subscriptions.revenue) AS 'Total Revenue'
FROM visits
INNER JOIN subscriptions
ON visits.account_id=subscriptions.account_id
GROUP BY region

/* 2. Which channel had the highest revenue per visit? What was its revenue per visit? */

SELECT visits.channel AS 'Channel', SUM(subscriptions.revenue)*COUNT(visits.visit_id) AS 'Revenue Per Visit'
FROM visits
INNER JOIN subscriptions
ON visits.account_id=subscriptions.account_id
GROUP BY channel
ORDER BY revenue DESC
LIMIT 1

/* 3. Which landing page had the highest overall conversion rate (% of visitors that go
on to become paying subscribers)? What was its conversion rate? */

SELECT visits.landing_page AS 'Landing Page', COUNT(visits.visit_id), COUNT(subscriptions.subscription_id)
FROM visits
INNER JOIN subscriptions
ON visits.account_id=subscriptions.account_id
GROUP BY landing_page

/* 7. Which region had the highest trial conversion rate (% of trials that start a
subscription)? What was its trial conversion rate? */

SELECT COUNT(DISTINCT visit_id) AS Visits FROM visits
SELECT COUNT(DISTINCT subscription_id) AS Subscriptions FROM subscriptions

SELECT COUNT(DISTINCT subscription_id) * 1.0 / COUNT(DISTINCT visit_id) * 100.0 AS 'Conversion Rate'
FROM visits
LEFT JOIN subscriptions
ON visits.account_id=subscriptions.account_id
