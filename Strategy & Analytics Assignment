/* Create Subscriptions Table */

CREATE TABLE subscriptions (
    subscription_id VARCHAR PRIMARY KEY,
    account_id VARCHAR,
    subscription_start_date DATE,
    subscription_end_date DATE,
    trial_start_date DATE,
    trial_end_date DATE,
    revenue DECIMAL (7,2)
)

/* Create Visits Table */

CREATE TABLE visits (
    visit_id VARCHAR PRIMARY KEY,
    account_id VARCHAR,
    day DATE,
    region VARCHAR,
    language VARCHAR,
    channel VARCHAR,
    landing_page VARCHAR
)

/* 1. How much revenue did each region generate within the time frame covered by
the data sets?

ANSWER:

Latin America: $2,373,438
Asia: $1,977,364
US/Canada: $1,583,260
Europe, Middle East, & Africa (Non-English): $1,317,909
Other English-Speaking Countries: $1,135,563 */

CODE:

SELECT region AS Region, SUM(revenue) AS Total_Revenue
FROM visits
LEFT JOIN subscriptions
ON visits.account_id=subscriptions.account_id
GROUP BY region

/* 2. Which channel had the highest revenue per visit? What was its revenue per visit? */

ANSWER:

CODE:

SELECT channel AS Channel, SUM(revenue)*COUNT(visit_id) AS Revenue_Per_Visit
FROM visits
LEFT JOIN subscriptions
ON visits.account_id=subscriptions.account_id
GROUP BY channel
ORDER BY Revenue_Per_Visit DESC
LIMIT 1

/* 3. Which landing page had the highest overall conversion rate (% of visitors that go
on to become paying subscribers)? What was its conversion rate? */

SELECT visits.landing_page AS 'Landing Page', COUNT(visits.visit_id), COUNT(subscriptions.subscription_id)
FROM visits
INNER JOIN subscriptions
ON visits.account_id=subscriptions.account_id
GROUP BY landing_page

/* 7. Which region had the highest trial conversion rate (% of trials that start a
subscription)? What was its trial conversion rate?

ANSWER: "Other English-Speaking Countries", 30.9% */

SELECT region AS 'Region', COUNT(DISTINCT subscription_id) * 1.0 / COUNT(DISTINCT visit_id) * 100.0 AS Conversion_Rate
FROM visits
LEFT JOIN subscriptions
ON visits.account_id=subscriptions.account_id
GROUP BY region
ORDER BY Conversion_Rate DESC
LIMIT 1
